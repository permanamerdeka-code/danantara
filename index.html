<script>
const BASE_URL =
  "https://script.google.com/macros/s/AKfycbwNKiWBvjO0l9BjmH-R-iu5TOAMtkaytVXsEqP6hUZzd_x5x3MtW0tQRihgQbwiGWOk/exec";

// ===== LOAD SPONSOR =====
async function loadSponsor(){
  const sponsorID = document.getElementById("sponsor").value.trim();

  document.getElementById("sponsorArea").innerHTML =
    '<div class="loading">Memuat sponsor…</div>';

  const payload = {
    action: sponsorID ? "getSponsor" : "getMainSponsor",
    hp: sponsorID
  };

  try{
    const req = await fetch(BASE_URL,{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify(payload)
    });
    const res = await req.json();

    if(!res.success){
      document.getElementById("sponsorArea").innerHTML =
        "<div class='loading'>Sponsor tidak ditemukan</div>";
      return;
    }

    let html = "<h4>Data Sponsor</h4>";

    res.data.forEach(s => {
      html += `
        <div class="sponsor-item" style="padding:12px; background:#f5f7ff; border-radius:10px; margin-bottom:10px;">
          <b>${s.nama}</b><br>
          HP: ${s.hp}
        </div>
      `;
    });

    // ===== Instruksi otomatis =====
    html += `
      <div style="
        margin-top:15px;
        padding:14px;
        background:#fff4ce;
        border-left:6px solid #ffcc00;
        border-radius:10px;
        font-size:15px;
        line-height:1.5;
      ">
        <b>Instruksi Pembayaran & Sponsorship:</b><br>
        • Pastikan sponsor di atas adalah benar.<br>
        • Jika ID sponsor kosong, sistem otomatis memakai 4 sponsor utama.<br>
        • Masukkan nomor HP sponsor jika Anda ingin sponsor tertentu.<br>
        • Setelah data sesuai, klik tombol <b>Saya Gabung</b>.
      </div>
    `;

    document.getElementById("sponsorArea").innerHTML = html;

  }catch(e){
    document.getElementById("sponsorArea").innerHTML =
      "<div class='loading'>Gagal memuat sponsor</div>";
  }
}

// load sponsor utama ketika halaman dibuka
loadSponsor();


// ===== JOIN NOW =====
async function joinNow(){
  const nama = document.getElementById("nama").value.trim();
  const hp = document.getElementById("hp").value.trim();
  const sponsor = document.getElementById("sponsor").value.trim();

  if(!nama || !hp){
    alert("Nama dan nomor HP wajib diisi!");
    return;
  }

  const payload = {
    action: "addBuyer",
    nama: nama,
    hp: hp,
    sponsor: sponsor || "AUTO"
  };

  try{
    const req = await fetch(BASE_URL,{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify(payload)
    });

    const res = await req.json();
    alert(res.message || "Pendaftaran Berhasil!");

  }catch(e){
    alert("Gagal menghubungi server: " + e);
  }
}
</script>
