<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Gabung Sponsor</title>

<style>
  body{
    margin:0;
    padding:0;
    font-family:Arial, sans-serif;
    background:#eef2f7;
  }
  .container{
    max-width:500px;
    margin:40px auto;
    background:white;
    padding:26px;
    border-radius:18px;
    box-shadow:0 4px 20px rgba(0,0,0,0.15);
  }
  h2{text-align:center;margin-bottom:20px;color:#222}
  label{font-weight:bold;margin-top:12px;display:block}
  input{
    width:100%;padding:12px;margin-top:6px;
    border-radius:10px;border:1px solid #ccc;font-size:16px
  }
  button{
    width:100%;margin-top:20px;padding:14px;font-size:18px;
    border:none;border-radius:12px;color:white;cursor:pointer;
    background:#0066ff;transition:0.2s;
  }
  button:hover{background:#004ed6}
  .sponsor-box{
    margin-top:25px;
    padding:14px;
    background:#f7f9fc;
    border-radius:12px;
    border:1px solid #d9e2ec;
  }
  .sponsor-item{padding:8px 0;border-bottom:1px solid #eee}
  .sponsor-item:last-child{border:none}
  .loading{text-align:center;color:#444;font-size:15px;margin-top:10px}
</style>
</head>

<body>
<div class="container">
  <h2>Gabung Sponsor</h2>

  <label>Nama Lengkap</label>
  <input id="nama" type="text" placeholder="Masukkan nama anda" />

  <label>No HP Anda</label>
  <input id="hp" type="text" placeholder="08xxxxxxxxxx" />

  <label>ID Sponsor (Opsional)</label>
  <input id="sponsor" type="text" placeholder="08xxxxxxxxxx" oninput="loadSponsor()" />

  <div id="sponsorArea" class="sponsor-box">
    <div class="loading">Memuat sponsor…</div>
  </div>

  <button onclick="joinNow()">Saya Gabung</button>
</div>

<script>
const BASE_URL =
  "https://script.google.com/macros/s/AKfycbwNKiWBvjO0l9BjmH-R-iu5TOAMtkaytVXsEqP6hUZzd_x5x3MtW0tQRihgQbwiGWOk/exec";

// ===== LOAD SPONSOR =====
async function loadSponsor(){
  const sponsorID = document.getElementById("sponsor").value.trim();

  document.getElementById("sponsorArea").innerHTML =
    '<div class="loading">Memuat sponsor…</div>';

  const payload = {
    action: sponsorID ? "getSponsor" : "getMainSponsor",
    hp: sponsorID
  };

  try{
    const req = await fetch(BASE_URL,{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify(payload)
    });
    const res = await req.json();

    if(!res.success){
      document.getElementById("sponsorArea").innerHTML =
        "<div class='loading'>Sponsor tidak ditemukan</div>";
      return;
    }

    // render daftar sponsor
    let html = "";
    res.data.forEach(s => {
      html += `
        <div class="sponsor-item">
          <b>${s.nama}</b><br>
          HP: ${s.hp}
        </div>
      `;
    });

    document.getElementById("sponsorArea").innerHTML = html;

  }catch(e){
    document.getElementById("sponsorArea").innerHTML =
      "<div class='loading'>Gagal memuat sponsor</div>";
  }
}

// load 4 sponsor utama saat halaman dibuka
loadSponsor();


// ===== JOIN NOW =====
async function joinNow(){
  const nama = document.getElementById("nama").value.trim();
  const hp = document.getElementById("hp").value.trim();
  const sponsor = document.getElementById("sponsor").value.trim();

  if(!nama || !hp){
    alert("Nama dan nomor HP wajib diisi!");
    return;
  }

  const payload = {
    action: "addBuyer",
    nama: nama,
    hp: hp,
    sponsor: sponsor || "AUTO"
  };

  try{
    const req = await fetch(BASE_URL,{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify(payload)
    });

    const res = await req.json();
    alert(res.message || "Pendaftaran Berhasil!");

  }catch(e){
    alert("Gagal menghubungi server: " + e);
  }
}
</script>
</body>
</html>
